import{B as _,g as y,P as S,h as x,W as j,G as R,u as f,j as e,S as E,F as I,R as v,d as T,s as b,a as U,b as k,A as N,r as p,c as L,e as M,T as P,f as C,i as V}from"./index-DRxbT8P4.js";class B extends _{async execute(s){try{if(y())this.showAlert({type:"error",content:"Ya tienes una sesión activa. Cierra la sesión actual para continuar"});else{this.showAlert({type:"waiting",content:null});const a={...s},c=await this.request(a);this.showAlert({type:null,content:null}),this.onComplete(c)}}catch(n){this.onError(n)}}}class w extends B{async request(s){return await S(this.url,s)}onError(s){x({error:s,customMessage:`Error creating ${this.itemName}`,showAlert:this.showAlert})}}class D extends j{async request(s){return await R(this.url,s)}onError(s){x({error:s,customMessage:`Error fetching ${this.itemName}`,showAlert:this.showAlert})}}var H={VITE_USE_MYSQ:"1",VITE_ITEMS_PER_PAGE:"30",VITE_ITEMS_PER_PAGE_USER:"30",VITE_MAX_LENGHT_ARRAY_NUMBER:"100",VITE_MAX_LENGHT_ARRAY_STRING:"50",VITE_MAX_LENGTH_ARRAY_DATA:"10",VITE_APP_API_BASE_URL:"http://localhost",VITE_MIDDLEWARE_URL_BASE:"http://localhost/api",VITE_VIEW_FILE:"http://localhost/files/files/view",VITE_SERVER_AUTH_URL_BASE:"http://localhost/auth",VITE_KEY:"0123456789abcdef0123456789abcdef0123456789abcdef0123456789abcdef",BASE_URL:"/",MODE:"development",DEV:!1,PROD:!0,SSR:!1};const W=({isAdminAccess:t,showAlert:s})=>{const n=f(),a=window.innerWidth<=600,c=()=>{const r=H.VITE_USE_MYSQL,i="http://localhost/api",h="http://localhost/auth";return r?(s({type:"verification",content:"Redirigiendo para iniciar sesión con tu correo institucional..."}),window.location.replace(`${h}/google/`),null):t?`${i}/auth/administrative/signinWithGoogle`:`${i}/auth/signinWithGoogle`},u=async()=>{const r=c();r!==null&&await new D(r,"User",s,l).execute({})},l=r=>{v({showAlert:s,navigate:n,response:r,onData:d})},d=r=>{if(r.url){s({type:"verification",content:"Redirigiendo para iniciar sesión con tu correo institucional..."});const i=r.url;window.location.replace(i);return}s({type:"error",content:"Ha ocurrido un error al intentar iniciar sesión. Por favor, verifica tus credenciales e inténtalo de nuevo"})};return e.jsx(e.Fragment,{children:e.jsx("div",{className:"flex w-full items-center justify-center gap-1 sm:gap-2",children:e.jsxs(E,{onClick:()=>u(),heightSM:"11",height:"10",children:[e.jsx(I,{size:25}),a?"Ingresar con tu Correo":"Ingresar con tu Correo Institucional"]})})})},G=({isAdminAccess:t,showAlert:s,handleSubmit:n,children:a})=>e.jsxs("form",{onSubmit:n,className:"space-y-4 flex-col items-center justify-center",children:[e.jsx(W,{isAdminAccess:t,showAlert:s}),e.jsx("div",{className:"gap-2",children:e.jsxs("div",{className:"flex w-full items-center",children:[e.jsx("hr",{className:"h-0.5 w-full rounded bg-gray-500"}),e.jsx("span",{className:"mx-2 mb-2 text-xl font-semibold text-gray-400",children:"o"}),e.jsx("hr",{className:"h-0.5 w-full rounded bg-gray-500"})]})}),e.jsx("div",{className:"space-y-2",children:a}),e.jsxs(E,{onClick:n,type:"submit",heightSM:"11",height:"10",children:[e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:"1.5",stroke:"currentColor",className:"w-8 h-8",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M9 12.75L11.25 15 15 9.75M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Iniciar Sesión"]})]}),F=({newItem:t,showAlert:s})=>{const n=f(),a=async()=>{if(t.email){const l="http://localhost/api/auth/recoverPassword";await new w(l,"User",s,c).execute({email:t.email})}else s({type:"error",content:"Por favor, ingrese su dirección de correo electrónico"})},c=l=>{v({showAlert:s,navigate:n,response:l,onVerification:u})},u=async l=>{s({type:"verification",content:l})};return e.jsx(e.Fragment,{children:e.jsx("button",{type:"button",onClick:a,className:"hover:font-semibold hover:text-orange-main hover:underline focus:text-orange-main",children:"¿Olvidaste tu contraseña?"})})};class Y{async authUser(){throw new Error("Sobrescribir para obtener la instancia de la Base de datos")}}class q extends Y{authUser(s,n,a,c){if(s){c({type:"verification",content:"Ha iniciado sesión con éxito. Bienvenido"});const{encryptedData:u,iv:l}=s,d=T(u,l);if(d.message==="Incorrect password"){c({type:"error",content:"Ha ocurrido un error al intentar iniciar sesión. Por favor, verifica tus credenciales e inténtalo de nuevo"});return}const r=d.token.split(" ")[1],i=d.refreshToken.split(" ")[1];b(r),U(i),n?(k(!0),a("/Administrative")):a("/Dashboard")}c({type:"error",content:"Ha ocurrido un error al intentar iniciar sesión. Por favor, verifica tus credenciales e inténtalo de nuevo"})}}const $=e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:1.5,children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M17.982 18.725A7.488 7.488 0 0 0 12 15.75a7.488 7.488 0 0 0-5.982 2.975m11.963 0a9 9 0 1 0-11.963 0m11.963 0A8.966 8.966 0 0 1 12 21a8.966 8.966 0 0 1-5.982-2.275M15 9.75a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"})}),X=()=>{const t=f(),[s,n]=N(),[a,c]=p.useState({email:"",password:""}),u=()=>{const o="http://localhost/api";return i?o+"/auth/administrative/signinWithEmail":o+"/auth/student/signinWithEmail"},l=async o=>{o.preventDefault();const m=V(a.password);if(m){n({type:"error",content:m});return}const A=u();await new w(A,"User",n,d).execute({...a})},d=o=>{v({showAlert:n,navigate:t,response:o,onData:r})},r=o=>{new q().authUser(o,i,t,n)};p.useEffect(()=>{t&&(L()?t("/VerifyAuth"):M(t))},[t]);const[i,h]=p.useState(!1),g=()=>{h(!i)};return e.jsxs(e.Fragment,{children:[s,e.jsxs(G,{handleSubmit:l,isAdminAccess:i,showAlert:n,children:[e.jsxs("div",{className:"mb-4",children:[e.jsx(P,{inputId:"emailUser",label:"Email",type:"email",value:a.email,onChange:o=>c({...a,email:o.target.value}),placeholder:"Ingresar Email",icon:$}),e.jsx("p",{className:"mt-4 mb-1 text-end text-sm sm:text-md text-gray-500",children:e.jsx(F,{newItem:a,showAlert:n})}),e.jsx(C,{label:"Contraseña",inputId:"passwordUser",value:a.password,onChange:o=>c({...a,password:o.target.value}),placeholder:"Ingresar Contraseña"})]}),e.jsxs("div",{className:"ml-1 flex items-center justify-start",children:[e.jsx("input",{id:"adminAccess",name:"adminAccess",type:"checkbox",checked:i,onChange:g,className:"form-checkbox h-5 w-5 rounded border-orange-second text-orange-main transition duration-150 ease-in-out"}),e.jsx("label",{htmlFor:"adminAccess",className:"ml-2 text-center text-sm sm:text-md text-gray-600",children:"Acceso a Sistema Administrativo"})]})]})]})};export{X as default};
